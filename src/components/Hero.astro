---
import Beneficts from "./Beneficts.astro";
import Button from "./Button.astro";
import VideoEmbed from "./VideoEmbed.astro";

// === A/B CONFIG ===
const COOKIE = "ab_vastu_title";
const titles: Record<'A'|'B', string> = { 
	A: `No es lo mismo construir una Casa linda, que diseñar un <span class="text-[#F3B23A]">Espacio para ser Feliz.</span>
    El Vastu Shastra es la Ciencia Ancestral que te enseña a crear desde la Energía…`,
  B: `No es lo mismo construir una Casa linda, que diseñar un <span class="text-[#F3B23A]">Espacio para ser Feliz.</span>
    El Vastu Shastra es la Ciencia Ancestral que te enseña a crear desde la Energía…`,
};
type Variant = 'A' | 'B';

// 1) Permitir override por query (?ab=A|B)
const urlAb = Astro.url?.searchParams.get("ab");
const qpVariant = urlAb === "A" || urlAb === "B" ? urlAb : null;

// 2) Leer cookie existente
const cookieVariant = Astro.cookies.get(COOKIE)?.value;
let variant = (qpVariant ?? cookieVariant ?? (Math.random() < 0.5 ? 'A' : 'B')) as Variant;

// 3) Persistir cookie (90 días). httpOnly en false para que puedas leerla desde el cliente si querés.
Astro.cookies.set(COOKIE, variant, {
  path: "/",
  maxAge: 60 * 60 * 24 * 90,
  sameSite: "lax",
  httpOnly: false,
});
---

<section class="pt-[32px] pb-16 md:pt-[60px] md:pb-[80px] px-4 relative overflow-hidden" data-ab-title={variant}>
  <div class="md:size-[880px] rounded-full bg-[#F3B23A] absolute blur-[90px] md:blur-[300px] md:-left-[440px] md:-top-[440px]"></div>

  <div class="max-w-[890px] mx-auto relative">
    <span class="text-center mx-auto text-[14px] block w-fit bg-[#F3B23A]/20 border border-[#F3B23A]/40 py-2 px-6 rounded-full">¿Querés crear espacios con armonía?</span>

    <!-- Título con A/B -->
    <h1
      class="text-[20px] md:text-[32px] text-center font-bold my-4 leading-[120%] md:leading-[110%]"
      set:html={titles[variant]}
    />

    <div class="max-w-[700px] mx-auto z-50 border-4 border-[#F3B23A] rounded-lg overflow-hidden relative">
      <p class="flex gap-2 items-center justify-center text-center p-2 md:p-4 md:text-[20px] font-bold bg-[#F3B23A]">
        Mira el video completo y agenda tu consulta
      </p>
      <div class="bg-[#F3B23A] w-full aspect-video">
        <VideoEmbed />
      </div>
    </div>

    <p class="max-w-[700px] mx-auto text-[14px] md:text-[16px] text-center mt-4">
      Sin renunciar a la técnica ni a tus formas, descubrí cómo aplicar los principios del Vastu para crear espacios con coherencia energética y propósito.
    </p>   

    {variant === 'A' && (
      <><Button texto="Agendar mi consulta »" /></>
    )}

    {variant === 'B' && (
      <><Button texto="Quiero saber si este camino es para mí »" /></>
    )}

    <p class="text-center italic text-white/80 text-[14px] relative">
      ¡Resolve tus dudas y aprovecha el precio de este mes!
    </p>
    
  </div>
</section>
